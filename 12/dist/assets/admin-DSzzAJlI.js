import{c as D,r as c,j as e,f as P,s as N,P as q,C as A,o as B,T as I,m as L,n as O,B as T,R as U,i as j,D as R,O as F,k as H,l as Y}from"./index-4Bumhera.js";/**
 * @license lucide-react v0.486.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const G=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]],J=D("arrow-right",G);/**
 * @license lucide-react v0.486.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const K=[["path",{d:"M12 2v4",key:"3427ic"}],["path",{d:"m16.2 7.8 2.9-2.9",key:"r700ao"}],["path",{d:"M18 12h4",key:"wj9ykh"}],["path",{d:"m16.2 16.2 2.9 2.9",key:"1bxg5t"}],["path",{d:"M12 18v4",key:"jadmvz"}],["path",{d:"m4.9 19.1 2.9-2.9",key:"bwix9q"}],["path",{d:"M2 12h4",key:"j09sii"}],["path",{d:"m4.9 4.9 2.9 2.9",key:"giyufr"}]],Q=D("loader",K);/**
 * @license lucide-react v0.486.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const V=[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]],W=D("upload",V),X={orderNumber:"ABC12345",customerName:"ישראל ישראלי",customerEmail:"israel@example.com",customerPhone:"050-1234567",items:[{title:"שולחן ערוך",quantity:1,price:120},{title:"משנה ברורה",quantity:2,price:110}],total:340,shippingAddress:"רחוב הרצל 1, תל אביב"};function Z(){const[r,m]=c.useState(X),[p,h]=c.useState("customer"),x=`
    <div style="text-align: center; margin-bottom: 30px;">
      <img src="https://talpiot-books.co.il/logo.png" alt="ספרי קודש תלפיות" style="max-width: 200px; margin-bottom: 15px;" />
      <div style="color: #666; font-size: 14px;">
        <p>טלפון: 050-418-1216</p>
        <p>רחוב הרב קוק 12, ירושלים</p>
      </div>
    </div>
  `,g=`
    <div dir="rtl" style="font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto; padding: 20px;">
      ${x}
      <h2 style="color: #112a55;">תודה על הזמנתך!</h2>
      <p>שלום ${r.customerName},</p>
      <p>הזמנתך התקבלה בהצלחה. להלן פרטי ההזמנה:</p>
      
      <div style="background: #f8f6f1; padding: 15px; border-radius: 8px; margin: 20px 0;">
        <h3 style="color: #a48327; margin-top: 0;">פריטים:</h3>
        <ul style="list-style: none; padding: 0;">
          ${r.items.map(i=>`
            <li style="border-bottom: 1px solid #ddd; padding: 10px 0;">
              ${i.title} - ${i.quantity} יח' - ${i.price} ₪
            </li>
          `).join("")}
        </ul>
        
        <p style="font-weight: bold; text-align: left; margin-top: 15px;">
          סה"כ לתשלום: ${r.total} ₪
        </p>
      </div>
      
      <div style="background: #f8f6f1; padding: 15px; border-radius: 8px; margin: 20px 0;">
        <h3 style="color: #a48327; margin-top: 0;">פרטי משלוח:</h3>
        <p style="margin: 0;">כתובת: ${r.shippingAddress}</p>
        <p style="margin: 0;">טלפון: ${r.customerPhone}</p>
      </div>
      
      <p>ניצור איתך קשר בהקדם לתיאום המשלוח.</p>
      
      <div style="margin-top: 30px; padding-top: 20px; border-top: 2px solid #f8f6f1;">
        <p>בברכה,<br>צוות ספרי קודש תלפיות</p>
      </div>
    </div>
  `,d=`
    <div dir="rtl" style="font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto; padding: 20px;">
      ${x}
      <h2 style="color: #112a55;">התקבלה הזמנה חדשה</h2>
      <p style="font-size: 1.2em; color: #a48327;">מספר הזמנה: ${r.orderNumber}</p>
      
      <div style="background: #f8f6f1; padding: 15px; border-radius: 8px; margin: 20px 0;">
        <h3 style="color: #a48327; margin-top: 0;">פרטי לקוח:</h3>
        <p>שם: ${r.customerName}</p>
        <p>אימייל: ${r.customerEmail}</p>
        <p>טלפון: ${r.customerPhone}</p>
        <p style="margin-bottom: 0;">כתובת: ${r.shippingAddress}</p>
      </div>
      
      <div style="background: #f8f6f1; padding: 15px; border-radius: 8px; margin: 20px 0;">
        <h3 style="color: #a48327; margin-top: 0;">פריטים:</h3>
        <ul style="list-style: none; padding: 0;">
          ${r.items.map(i=>`
            <li style="border-bottom: 1px solid #ddd; padding: 10px 0;">
              ${i.title} - ${i.quantity} יח' - ${i.price} ₪
            </li>
          `).join("")}
        </ul>
        
        <p style="font-weight: bold; text-align: left; margin-top: 15px;">
          סה"כ: ${r.total} ₪
        </p>
      </div>
    </div>
  `;return e.jsxs("div",{className:"max-w-4xl mx-auto p-8",children:[e.jsx("h1",{className:"text-3xl font-bold text-[#112a55] mb-6",children:"תצוגה מקדימה של תבנית המייל"}),e.jsxs("div",{className:"mb-6 flex gap-4",children:[e.jsx("button",{onClick:()=>h("customer"),className:`px-4 py-2 rounded ${p==="customer"?"bg-[#112a55] text-white":"bg-gray-100 text-gray-700"}`,children:"מייל ללקוח"}),e.jsx("button",{onClick:()=>h("store"),className:`px-4 py-2 rounded ${p==="store"?"bg-[#112a55] text-white":"bg-gray-100 text-gray-700"}`,children:"מייל לחנות"})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-lg overflow-hidden",children:[e.jsxs("div",{className:"border-b p-4 bg-gray-50",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-bold",children:"נושא:"}),e.jsx("span",{children:p==="customer"?`הזמנה מספר ${r.orderNumber} התקבלה בהצלחה`:`הזמנה חדשה - ${r.orderNumber}`})]}),e.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[e.jsx("span",{className:"font-bold",children:"אל:"}),e.jsx("span",{children:p==="customer"?r.customerEmail:"orders@talpiot-books.co.il"})]})]}),e.jsx("div",{className:"p-8",dangerouslySetInnerHTML:{__html:p==="customer"?g:d}})]})]})}function ee(){const{categories:r}=P(),[m,p]=c.useState("select"),[h,x]=c.useState(1),[g,d]=c.useState(!1),[i,w]=c.useState(null),[k,_]=c.useState(""),[$,t]=c.useState(null),[n,l]=c.useState([]),[a,o]=c.useState({title:"",author:"",description:"",price:"",image_url:"",availability:"available",isbn:"",publisher:"",publication_year:"",pages:"",language:"hebrew",binding:"hardcover",stock:"1",is_new_arrival:!1,is_new_in_market:!1}),E=async s=>{const u=s.target.files[0];if(u&&(w(u),_(URL.createObjectURL(u)),m==="ai")){d(!0);try{const b=new FormData;b.append("image",u);const{data:f,error:y}=await N.functions.invoke("analyze-book-image",{body:b});if(y)throw y;t(f),o(v=>({...v,title:f.title||"",author:f.author||"",description:f.description||"",isbn:f.isbn||""})),x(2)}catch(b){console.error("Error analyzing image:",b),alert("שגיאה בזיהוי הספר. אנא נסה שוב או הזן את הפרטים ידנית.")}finally{d(!1)}}},z=async s=>{s.preventDefault(),d(!0);try{let u=a.image_url;if(i){const v=`${Date.now()}-${i.name}`,{data:S,error:C}=await N.storage.from("book-images").upload(`books/${v}`,i);if(C)throw C;const{data:{publicUrl:M}}=N.storage.from("book-images").getPublicUrl(`books/${v}`);u=M}const b={...a,image_url:u},{data:f,error:y}=await N.from("books").insert([b]).select().single();if(y)throw y;if(n.length>0){const v=n.map(C=>({book_id:f.id,category_id:C})),{error:S}=await N.from("book_categories").insert(v);if(S)throw S}alert("הספר נוסף בהצלחה!"),o({title:"",author:"",description:"",price:"",image_url:"",availability:"available",isbn:"",publisher:"",publication_year:"",pages:"",language:"hebrew",binding:"hardcover",stock:"1",is_new_arrival:!1,is_new_in_market:!1}),l([]),w(null),_(""),x(1)}catch(u){console.error("Error adding book:",u),alert("שגיאה בהוספת הספר. אנא נסה שוב.")}finally{d(!1)}};return m==="select"?e.jsxs("div",{className:"max-w-4xl mx-auto p-8",children:[e.jsx("h1",{className:"text-3xl font-bold text-[#112a55] mb-8",children:"הוספת ספר חדש"}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[e.jsxs("button",{onClick:()=>p("simple"),className:"bg-white p-8 rounded-xl shadow-lg hover:shadow-xl transition-shadow text-center",children:[e.jsx("h2",{className:"text-xl font-bold text-[#112a55] mb-4",children:"הוספה רגילה"}),e.jsx("p",{className:"text-gray-600",children:"הזנה ידנית של כל פרטי הספר"})]}),e.jsxs("button",{onClick:()=>p("ai"),className:"bg-white p-8 rounded-xl shadow-lg hover:shadow-xl transition-shadow text-center",children:[e.jsx("h2",{className:"text-xl font-bold text-[#112a55] mb-4",children:"הוספה חכמה"}),e.jsx("p",{className:"text-gray-600",children:"העלאת תמונה וזיהוי אוטומטי של פרטי הספר"})]})]}),e.jsxs("button",{onClick:()=>window.history.back(),className:"mt-8 text-[#112a55] hover:text-[#1a3c70] flex items-center gap-2",children:[e.jsx(J,{size:20}),"חזרה"]})]}):e.jsxs("div",{className:"max-w-4xl mx-auto p-8",children:[e.jsx("h1",{className:"text-3xl font-bold text-[#112a55] mb-8",children:m==="ai"?"הוספת ספר - זיהוי חכם":"הוספת ספר"}),m==="ai"&&h===1&&e.jsxs("div",{className:"bg-white rounded-xl shadow-lg p-8 text-center",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h2",{className:"text-xl font-bold text-[#112a55] mb-4",children:"העלאת תמונת הספר"}),e.jsx("p",{className:"text-gray-600",children:"העלה תמונה ברורה של כריכת הספר לזיהוי אוטומטי"})]}),e.jsxs("label",{className:"block w-full max-w-md mx-auto",children:[e.jsx("input",{type:"file",accept:"image/*",onChange:E,className:"hidden"}),e.jsxs("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-8 hover:border-[#112a55] transition-colors cursor-pointer",children:[e.jsx(W,{className:"mx-auto text-gray-400 mb-4",size:48}),e.jsx("p",{className:"text-gray-600",children:"לחץ להעלאת תמונה"})]})]}),g&&e.jsxs("div",{className:"mt-8 flex items-center justify-center gap-4 text-[#112a55]",children:[e.jsx(Q,{className:"animate-spin"}),e.jsx("span",{children:"מזהה את הספר..."})]})]}),(m==="simple"||h===2)&&e.jsxs("form",{onSubmit:z,className:"bg-white rounded-xl shadow-lg p-8",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[k&&e.jsx("div",{className:"md:col-span-2",children:e.jsx("img",{src:k,alt:"תצוגה מקדימה",className:"max-h-64 mx-auto object-contain"})}),m==="simple"&&e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-gray-700 mb-1",children:"תמונת הספר"}),e.jsx("input",{type:"file",accept:"image/*",onChange:E,className:"w-full border rounded-lg p-2"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 mb-1",children:"שם הספר *"}),e.jsx("input",{type:"text",value:a.title,onChange:s=>o({...a,title:s.target.value}),required:!0,className:"w-full border rounded-lg p-2"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 mb-1",children:"מחבר"}),e.jsx("input",{type:"text",value:a.author,onChange:s=>o({...a,author:s.target.value}),className:"w-full border rounded-lg p-2"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-gray-700 mb-1",children:"תיאור"}),e.jsx("textarea",{value:a.description,onChange:s=>o({...a,description:s.target.value}),rows:"3",className:"w-full border rounded-lg p-2"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 mb-1",children:"מחיר *"}),e.jsx("input",{type:"number",value:a.price,onChange:s=>o({...a,price:s.target.value}),required:!0,min:"0",step:"0.01",className:"w-full border rounded-lg p-2"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 mb-1",children:"קטגוריות *"}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:r.map(s=>e.jsxs("label",{className:"flex items-center gap-2 p-2 border rounded hover:bg-gray-50",children:[e.jsx("input",{type:"checkbox",checked:n.includes(s.id),onChange:u=>{u.target.checked?l([...n,s.id]):l(n.filter(b=>b!==s.id))},className:"form-checkbox h-5 w-5 text-[#112a55]"}),e.jsx("span",{children:s.name})]},s.id))}),n.length===0&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:"יש לבחור לפחות קטגוריה אחת"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 mb-1",children:"ISBN"}),e.jsx("input",{type:"text",value:a.isbn,onChange:s=>o({...a,isbn:s.target.value}),className:"w-full border rounded-lg p-2"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 mb-1",children:"הוצאה לאור"}),e.jsx("input",{type:"text",value:a.publisher,onChange:s=>o({...a,publisher:s.target.value}),className:"w-full border rounded-lg p-2"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 mb-1",children:"שנת הוצאה"}),e.jsx("input",{type:"number",value:a.publication_year,onChange:s=>o({...a,publication_year:s.target.value}),min:"1800",max:new Date().getFullYear(),className:"w-full border rounded-lg p-2"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 mb-1",children:"מספר עמודים"}),e.jsx("input",{type:"number",value:a.pages,onChange:s=>o({...a,pages:s.target.value}),min:"1",className:"w-full border rounded-lg p-2"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 mb-1",children:"שפה"}),e.jsxs("select",{value:a.language,onChange:s=>o({...a,language:s.target.value}),className:"w-full border rounded-lg p-2",children:[e.jsx("option",{value:"hebrew",children:"עברית"}),e.jsx("option",{value:"english",children:"אנגלית"}),e.jsx("option",{value:"aramaic",children:"ארמית"}),e.jsx("option",{value:"other",children:"אחר"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 mb-1",children:"כריכה"}),e.jsxs("select",{value:a.binding,onChange:s=>o({...a,binding:s.target.value}),className:"w-full border rounded-lg p-2",children:[e.jsx("option",{value:"hardcover",children:"קשה"}),e.jsx("option",{value:"softcover",children:"רכה"}),e.jsx("option",{value:"leather",children:"עור"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 mb-1",children:"כמות במלאי *"}),e.jsx("input",{type:"number",value:a.stock,onChange:s=>o({...a,stock:s.target.value}),required:!0,min:"0",className:"w-full border rounded-lg p-2"})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:a.is_new_arrival,onChange:s=>o({...a,is_new_arrival:s.target.checked}),className:"form-checkbox h-5 w-5 text-[#112a55]"}),e.jsx("span",{children:"חדש באתר"})]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:a.is_new_in_market,onChange:s=>o({...a,is_new_in_market:s.target.checked}),className:"form-checkbox h-5 w-5 text-[#112a55]"}),e.jsx("span",{children:"חדש בשוק"})]})]})]}),e.jsxs("div",{className:"mt-8 flex justify-end gap-4",children:[e.jsx("button",{type:"button",onClick:()=>{m==="ai"&&h===2?x(1):p("select")},className:"px-4 py-2 text-gray-600 hover:text-gray-800",children:"חזרה"}),e.jsx("button",{type:"submit",disabled:g,className:"px-6 py-2 bg-[#112a55] text-white rounded-lg hover:bg-[#1a3c70] disabled:bg-gray-400",children:g?"שומר...":"שמור ספר"})]})]})]})}const ae=[{id:"1",name:"הלכה",children:[{id:"1-1",name:"שולחן ערוך"},{id:"1-2",name:"משנה ברורה"}]},{id:"2",name:'תנ"ך',children:[{id:"2-1",name:"חומש"},{id:"2-2",name:"נביאים"},{id:"2-3",name:"כתובים"}]},{id:"3",name:"מחשבה",children:[]},{id:"4",name:"קבלה",children:[]}];function se(){const[r,m]=c.useState(ae),[p,h]=c.useState(!1),[x,g]=c.useState(null),[d,i]=c.useState({name:"",parent_id:""}),w=t=>{if(t.preventDefault(),x)m(n=>n.map(l=>l.id===x.id?{...l,name:d.name}:l.children?{...l,children:l.children.map(a=>a.id===x.id?{...a,name:d.name}:a)}:l));else{const n={id:Date.now().toString(),name:d.name,children:[]};d.parent_id?m(l=>l.map(a=>a.id===d.parent_id?{...a,children:[...a.children||[],{...n,id:`${a.id}-${a.children.length+1}`}]}:a)):m(l=>[...l,n])}h(!1),g(null),i({name:"",parent_id:""})},k=t=>{g(t),i({name:t.name,parent_id:t.id.includes("-")?t.id.split("-")[0]:""}),h(!0)},_=t=>{window.confirm("האם אתה בטוח שברצונך למחוק קטגוריה זו?")&&m(n=>n.filter(l=>l.id===t?!1:(l.children&&(l.children=l.children.filter(a=>a.id!==t)),!0)))},$=(t,n=0)=>{var l;return e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-4 hover:shadow-md transition-shadow",style:{marginRight:`${n*20}px`},children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[n>0&&e.jsx(A,{size:16,className:"text-gray-400"}),e.jsx("span",{className:"font-medium",children:t.name})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>k(t),className:"p-1 text-blue-600 hover:bg-blue-50 rounded",children:e.jsx(B,{size:16})}),e.jsx("button",{onClick:()=>_(t.id),className:"p-1 text-red-600 hover:bg-red-50 rounded",children:e.jsx(I,{size:16})})]})]}),((l=t.children)==null?void 0:l.length)>0&&e.jsx("div",{className:"mt-2 space-y-2",children:t.children.map(a=>$(a,n+1))})]},t.id)};return e.jsxs("div",{className:"max-w-4xl mx-auto p-8",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h1",{className:"text-3xl font-bold text-[#112a55]",children:"ניהול קטגוריות"}),e.jsxs("button",{onClick:()=>{g(null),i({name:"",parent_id:""}),h(!0)},className:"flex items-center gap-2 bg-[#a48327] text-white px-4 py-2 rounded-lg hover:bg-[#8b6f1f] transition-colors",children:[e.jsx(q,{size:20}),"הוסף קטגוריה"]})]}),e.jsx("div",{className:"space-y-4",children:r.map(t=>$(t))}),p&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 max-w-md w-full",children:[e.jsx("h2",{className:"text-2xl font-bold text-[#112a55] mb-6",children:x?"עריכת קטגוריה":"הוספת קטגוריה חדשה"}),e.jsxs("form",{onSubmit:w,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 mb-1",children:"שם הקטגוריה"}),e.jsx("input",{type:"text",value:d.name,onChange:t=>i({...d,name:t.target.value}),required:!0,className:"w-full border rounded-lg p-2"})]}),!x&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 mb-1",children:"קטגוריית אב"}),e.jsxs("select",{value:d.parent_id,onChange:t=>i({...d,parent_id:t.target.value}),className:"w-full border rounded-lg p-2",children:[e.jsx("option",{value:"",children:"ללא קטגוריית אב"}),r.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]})]}),e.jsxs("div",{className:"flex justify-end gap-4 mt-6",children:[e.jsx("button",{type:"button",onClick:()=>{h(!1),g(null),i({name:"",parent_id:""})},className:"px-4 py-2 text-gray-600 hover:text-gray-800",children:"ביטול"}),e.jsx("button",{type:"submit",className:"px-6 py-2 bg-[#112a55] text-white rounded-lg hover:bg-[#1a3c70]",children:x?"עדכן":"הוסף"})]})]})]})})]})}L.createRoot(document.getElementById("root")).render(e.jsx(O.StrictMode,{children:e.jsx(T,{children:e.jsxs(U,{children:[e.jsx(j,{path:"/",element:e.jsx(R,{})}),e.jsx(j,{path:"/admin",element:e.jsx(R,{})}),e.jsx(j,{path:"/admin/orders",element:e.jsx(F,{})}),e.jsx(j,{path:"/admin/products",element:e.jsx(H,{})}),e.jsx(j,{path:"/admin/add-book",element:e.jsx(ee,{})}),e.jsx(j,{path:"/admin/categories",element:e.jsx(se,{})}),e.jsx(j,{path:"/admin/reports",element:e.jsx(Y,{})}),e.jsx(j,{path:"/admin/email-preview",element:e.jsx(Z,{})})]})})}));
